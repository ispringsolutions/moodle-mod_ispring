{"version":3,"file":"api.min.js","sources":["../src/api.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n *\n * @class       mod_ispring/api\n * @copyright   2023 iSpring Solutions Inc.\n * @author      Desktop Team <desktop-team@ispring.com>\n * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {call} from 'core/ajax';\n\nclass Api {\n    constructor(sessionId, contentId, returnUrl) {\n        this._sessionId = sessionId;\n        this._contentId = contentId;\n        this._returnUrl = returnUrl;\n    }\n\n    startSession(state) {\n        call([{\n            methodname: 'mod_ispring_start_session',\n            args: {\n                'content_id': this._contentId,\n                'state': JSON.stringify(state)\n            }\n        }])[0]\n            .then((result) => {\n                this._sessionId = result['session_id'];\n            })\n            .catch(() => {\n            });\n    }\n\n    setState(state) {\n        call([{\n            methodname: 'mod_ispring_set_state',\n            args: {\n                'session_id': this._sessionId,\n                'state': JSON.stringify(state)\n            }\n        }])[0]\n            .then(() => {\n            })\n            .catch(() => {\n            });\n    }\n\n    endSession(state) {\n        call([{\n            methodname: 'mod_ispring_end_session',\n            args: {\n                'session_id': this._sessionId,\n                'state': JSON.stringify(state)\n            }\n        }])[0]\n            .then(() => {\n            })\n            .catch(() => {\n            });\n    }\n\n    terminate() {\n        window.location.replace(this._returnUrl);\n    }\n}\n\n/**\n * @param {string|null} persistStateId\n * @param {string|null} persistState\n */\nfunction setPlayerData(persistStateId, persistState) {\n    if (localStorage && persistStateId) {\n        if (persistState) {\n            localStorage.setItem(persistStateId, persistState);\n        } else {\n            localStorage.removeItem(persistStateId);\n        }\n    }\n}\n\nexport const init = (contentId, playerUrl, iframeId, returnUrl) => {\n    window['ispring_moodle_connector'] = new Api(0, contentId, returnUrl);\n    call([{\n        methodname: 'mod_ispring_get_player_data',\n        args: {\n            'content_id': contentId\n        }\n    }])[0]\n        .then((result) => {\n            setPlayerData(result['persist_state_id'], result['persist_state']);\n        })\n        .catch(() /*noexcept*/ => {\n        })\n        .then(() => {\n            document.getElementById(iframeId).src = playerUrl;\n        });\n};"],"names":["Api","constructor","sessionId","contentId","returnUrl","_sessionId","_contentId","_returnUrl","startSession","state","methodname","args","this","JSON","stringify","then","result","catch","setState","endSession","terminate","window","location","replace","playerUrl","iframeId","persistStateId","persistState","localStorage","setItem","removeItem","document","getElementById","src"],"mappings":";;;;;;;;MAyBMA,IACFC,YAAYC,UAAWC,UAAWC,gBACzBC,WAAaH,eACbI,WAAaH,eACbI,WAAaH,UAGtBI,aAAaC,sBACJ,CAAC,CACFC,WAAY,4BACZC,KAAM,YACYC,KAAKN,iBACVO,KAAKC,UAAUL,WAE5B,GACCM,MAAMC,cACEX,WAAaW,OAAM,cAE3BC,OAAM,SAIfC,SAAST,sBACA,CAAC,CACFC,WAAY,wBACZC,KAAM,YACYC,KAAKP,iBACVQ,KAAKC,UAAUL,WAE5B,GACCM,MAAK,SAELE,OAAM,SAIfE,WAAWV,sBACF,CAAC,CACFC,WAAY,0BACZC,KAAM,YACYC,KAAKP,iBACVQ,KAAKC,UAAUL,WAE5B,GACCM,MAAK,SAELE,OAAM,SAIfG,YACIC,OAAOC,SAASC,QAAQX,KAAKL,2BAkBjB,CAACJ,UAAWqB,UAAWC,SAAUrB,aACjDiB,OAAM,yBAA+B,IAAIrB,IAAI,EAAGG,UAAWC,0BACtD,CAAC,CACFM,WAAY,8BACZC,KAAM,YACYR,cAElB,GACCY,MAAMC,aAlBQU,eAAgBC,aAAhBD,eAmBGV,OAAM,iBAnBOW,aAmBeX,OAAM,cAlBpDY,cAAgBF,iBACZC,aACAC,aAAaC,QAAQH,eAAgBC,cAErCC,aAAaE,WAAWJ,oBAgB3BT,OAAM,SAENF,MAAK,KACFgB,SAASC,eAAeP,UAAUQ,IAAMT"}