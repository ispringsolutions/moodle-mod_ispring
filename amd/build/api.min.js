define("mod_ispring/api",["exports","core/ajax"],(function(_exports,_ajax){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;class Api{constructor(sessionId,contentId,returnUrl,boxErrorId,iframeId){this._sessionId=sessionId,this._contentId=contentId,this._returnUrl=returnUrl,this._boxErrorId=boxErrorId,this._iframeId=iframeId}startSession(state){(0,_ajax.call)([{methodname:"mod_ispring_start_session",args:{content_id:this._contentId,state:JSON.stringify(state)}}])[0].then((result=>{this._sessionId=result.session_id})).catch((()=>{}))}setState(state){(0,_ajax.call)([{methodname:"mod_ispring_set_state",args:{session_id:this._sessionId,state:JSON.stringify(state)}}])[0].then((response=>{showErrorBoxIfNeeded(response,this._boxErrorId,this._iframeId)})).catch((()=>{}))}endSession(state){(0,_ajax.call)([{methodname:"mod_ispring_end_session",args:{session_id:this._sessionId,state:JSON.stringify(state)}}])[0].then((response=>{showErrorBoxIfNeeded(response,this._boxErrorId,this._iframeId)})).catch((()=>{}))}terminate(){window.location.replace(this._returnUrl)}}function showErrorBoxIfNeeded(response,boxId,iframeId){if("warning"in response&&response.warning.length>0){const warning=response.warning[0];"invalidplayerid"===warning.warningcode&&(document.getElementById(boxId).style.display="block",document.getElementById(boxId).innerHTML=warning.message,document.getElementById(iframeId).parentElement.style.display="none")}}_exports.init=(contentId,playerUrl,iframeId,returnUrl,preloaderId,errorBoxId)=>{window.ispring_moodle_connector=new Api(0,contentId,returnUrl,errorBoxId,iframeId),(0,_ajax.call)([{methodname:"mod_ispring_get_player_data",args:{content_id:contentId}}])[0].then((result=>{var persistStateId,persistState;persistStateId=result.persist_state_id,persistState=result.persist_state,localStorage&&persistStateId&&(persistState?localStorage.setItem(persistStateId,persistState):localStorage.removeItem(persistStateId))})).catch((()=>{})).then((()=>{document.getElementById(iframeId).src=playerUrl,document.getElementById(preloaderId).remove()}))}}));

//# sourceMappingURL=api.min.js.map